#!/usr/bin/env python

import rospy
from std_msgs.msg import String
import dynamic.rosdy as rosdy

class art:
	def __init__(self, namen):
		self.name = namen
		self.pub = []
		self.sub = []
	def addPub(self, namen):
		if not (namen in self.pub):
			self.pub.append(namen)
	def addSub(self, namen):
		if not (namen in self.sub):
			self.sub.append(namen)
	def prinT(self):
		print self.name
		print " - Publisher"
		for d in self.pub:
			print " -- {0}".format(d)
		print " - Subscriber"
		for d in self.sub:
			print " -- {0}".format(d)
		

	
	
		
class lart:
	def __init__(self):
		self.lis = []

	def addPub(self, naem, pubn):
		i=0
		test = True
		for v in self.lis:
			if v.name == naem:
				q = self.lis.pop(i)
				q.addPub(pubn)
				self.lis.append(q)
				test = False
				break
			i+=1
		if test:
			aa = art(naem)
			aa.addPub(pubn)
			self.lis.append(aa)


	def addSub(self, naem, subn):
		i=0
		test = True
		for v in self.lis:
			if v.name == naem:
				q = self.lis.pop(i)
				q.addSub(subn)
				self.lis.append(q)
				q.prinT()
				test=False
				break
			i+=1
		if test:
			aa = art(naem)
			aa.addSub(subn)
			self.lis.append(aa)

	def prinT(self):
		for d in self.lis:
			d.prinT()
			print "------------"


if __name__ == '__main__':
	rospy.init_node('rat', anonymous=True)
	rat = rosdy.Controller('ont')
	"""
	var = raw_input("Enter something: ")
	rat.join()
	var = raw_input("Enter something: ")
	rat.unjoin()
	"""
	rat.findCaps()
	#rat.join('hjk')
	#rospy.sleep(10)
	#rat.unjoin()
	#rospy.sleep(5)
	#rat.join('fgh')

	#job = rat.pairing_nodes(rat.pub)
	#jot = job[0]
	#rat.talk_nodes(rat.pub,jot)
	#topic = 'cap_%s' %(rat.pub)
	#print rat.pick_up_cap_srv(topic)
	#topic = 'cap_%s' %(rat.sub)
	#print rat.pick_up_cap_srv(topic)

	
	#print xs
	xp = rat.sublist[:]


	daew = lart()
	
	#print 'Subscribers'
	for x in xp:
		#print 'name: '+x.name
		#print 'fut: ' + x.fut
		daew.addSub(x.name, x.fut)


	
	xp2 = rat.publist[:]
	
	#print 'Publishers'
	for x in xp2:
		#print 'pubname: '+ x.name
		#print 'pubfut: ' + x.fut
		daew.addPub(x.name, x.fut)


	daew.prinT()
		


	#rat.join(xp[0].fut,xp2[0].fut)

	#rat.disconnect(xs)
	#rat.disconnect(xp)

	
